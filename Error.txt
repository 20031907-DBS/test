/**
   * Connect to the WebSocket server
   */
  connect(userId, token) {
    if (this.socket && this.isConnected) {
      console.log('WebSocket already connected');
      return;
    }

    // Get server URL from environment or try common ports
    const serverUrl = process.env.NEXT_PUBLIC_WEBSOCKET_URL || this.findAvailableServer();

    this.socket = io(serverUrl, {
      auth: {
        user_id: userId,
        userId, // Keep for backward compatibility
        token
      },
      transports: ['websocket', 'polling'],
      timeout: 20000,
      withCredentials: true, // Important for session-based auth
    });

    this.setupEventListeners();
  }